<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trendy Finance Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f0f3f7, #d9e2ec);
    color: #2c3e50;
    margin: 0; padding: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 2rem;
    transition: background 0.4s, color 0.4s;
  }
  .container {
    max-width: 480px;
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    padding: 2rem;
    width: 100%;
    user-select: none;
  }
  h1 {
    font-weight: 600;
    font-size: 2rem;
    margin-bottom: 1.5rem;
    color: #34495e;
    text-align: center;
  }
  label {
    font-weight: 600;
    display: block;
    margin-top: 1rem;
    margin-bottom: 0.3rem;
    color: #34495e;
  }
  input[type="text"],
  input[type="number"],
  select {
    width: 100%;
    padding: 0.6rem 0.9rem;
    border-radius: 10px;
    border: 1.5px solid #ccc;
    font-size: 1rem;
    transition: border-color 0.3s;
    outline-offset: 2px;
  }
  input[type="text"]:focus,
  input[type="number"]:focus,
  select:focus {
    border-color: #2980b9;
  }
  button {
    background: #2980b9;
    border: none;
    padding: 0.7rem 1.4rem;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
    margin-top: 1rem;
  }
  button:hover {
    background: #3498db;
  }
  #voiceBtn {
    background: #27ae60;
    margin-left: 1rem;
  }
  #voiceBtn.listening {
    background: #c0392b;
  }
  ul#list {
    list-style: none;
    padding: 0;
    margin-top: 1rem;
    max-height: 280px;
    overflow-y: auto;
  }
  .transaction-card {
    background: white;
    border-radius: 15px;
    padding: 1rem 1.2rem;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    transition: transform 0.2s ease;
    align-items: center;
  }
  .transaction-card:hover {
    transform: translateY(-4px);
  }
  .income {
    border-left: 6px solid #27ae60;
  }
  .expense {
    border-left: 6px solid #c0392b;
  }
  .amount {
    font-weight: 700;
    font-size: 1.1rem;
    min-width: 90px;
    text-align: right;
  }
  .desc-cat {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .category-badge {
    display: inline-block;
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    border-radius: 8px;
    color: white;
    margin-top: 0.3rem;
    font-weight: 600;
    user-select: none;
    width: fit-content;
  }
  .actions {
    display: flex;
    gap: 0.5rem;
  }
  .actions button {
    background: transparent;
    color: #2980b9;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: color 0.3s;
  }
  .actions button.delete {
    color: #c0392b;
  }
  .actions button:hover {
    text-decoration: underline;
  }
  .summary {
    font-weight: 600;
    font-size: 1.1rem;
    margin-top: 1rem;
    text-align: center;
  }
  .btn-group {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.7rem;
    margin-top: 1.2rem;
  }
  #backupArea {
    margin-top: 1rem;
    width: 100%;
    min-height: 100px;
    font-family: monospace;
    padding: 0.8rem;
    border-radius: 10px;
    border: 1.5px solid #ccc;
    resize: vertical;
    background: #fefefe;
  }
  #darkModeToggle {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    background: #2980b9;
    border: none;
    padding: 0.8rem 1.2rem;
    border-radius: 50%;
    color: white;
    font-size: 1.4rem;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transition: background 0.3s;
  }
  #darkModeToggle:hover {
    background: #3498db;
  }
  canvas {
    max-width: 100%;
    margin-top: 1.5rem;
    border-radius: 20px;
    background: white;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  }
  @media (max-width: 520px) {
    .container {
      padding: 1.5rem;
      margin: 1rem;
    }
    .btn-group {
      flex-direction: column;
    }
  }

  /* Dark mode */
  body.dark {
    background: linear-gradient(135deg, #2c3e50, #4a6274);
    color: #ecf0f1;
  }
  body.dark .container {
    background: rgba(40,44,52,0.85);
    box-shadow: 0 8px 24px rgba(255,255,255,0.1);
  }
  body.dark input,
  body.dark select {
    background: #34495e;
    border-color: #567;
    color: #ecf0f1;
  }
  body.dark input:focus,
  body.dark select:focus {
    border-color: #3498db;
  }
  body.dark button {
    background: #3498db;
  }
  body.dark button:hover {
    background: #2980b9;
  }
  body.dark #voiceBtn {
    background: #27ae60;
  }
  body.dark #voiceBtn.listening {
    background: #c0392b;
  }
  body.dark .transaction-card {
    background: #3a3f4b;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  body.dark .actions button {
    color: #5dade2;
  }
  body.dark .actions button.delete {
    color: #e74c3c;
  }
  body.dark .category-badge {
    color: #ecf0f1;
  }
</style>
</head>
<body>
<div class="container" role="main" aria-label="Financial Management System">

  <h1>Trendy Finance Manager</h1>

  <label for="desc">Description</label>
  <input type="text" id="desc" placeholder="E.g. Salary, Groceries" autocomplete="off" aria-required="true" />

  <label for="amount">Amount (negative for expense)</label>
  <input type="number" id="amount" placeholder="E.g. 1000 or -150" step="0.01" aria-required="true" />

  <label for="category">Category</label>
  <select id="category" aria-label="Select transaction category">
    <option value="Salary" data-color="#27ae60">Salary</option>
    <option value="Food" data-color="#e67e22">Food</option>
    <option value="Transport" data-color="#2980b9">Transport</option>
    <option value="Shopping" data-color="#8e44ad">Shopping</option>
    <option value="Entertainment" data-color="#f39c12">Entertainment</option>
    <option value="Health" data-color="#c0392b">Health</option>
    <option value="Other" data-color="#7f8c8d">Other</option>
  </select>

  <div class="controls" aria-label="Add transaction controls">
    <button id="addBtn" aria-label="Add transaction">Add Transaction</button>
    <button id="voiceBtn" title="Add via Voice Input" aria-label="Add transaction by voice input">🎤 Voice</button>
  </div>

  <h3>Transactions</h3>
  <ul id="list" aria-live="polite" aria-label="List of transactions"></ul>

  <h3>Summary</h3>
  <p class="summary">Balance: <span id="balance">$0.00</span></p>
  <p class="summary">Income: <span id="income">$0.00</span></p>
  <p class="summary">Expense: <span id="expense">$0.00</span></p>

  <div class="btn-group">
    <button id="downloadBtn" aria-label="Download transactions CSV">Download CSV</button>
    <button id="backupBtn" aria-label="Backup data to JSON">Backup JSON</button>
    <button id="restoreBtn" aria-label="Restore data from JSON">Restore JSON</button>
  </div>

  <textarea id="backupArea" placeholder="Backup data appears here or paste JSON here to restore"></textarea>

  <canvas id="pieChart" aria-label="Spending by category pie chart"></canvas>

</div>

<button id="darkModeToggle" title="Toggle Dark Mode" aria-pressed="false" aria-label="Toggle dark mode">🌓</button>

<script>
  (() => {
    // Elements
    const descInput = document.getElementById('desc');
    const amountInput = document.getElementById('amount');
    const categorySelect = document.getElementById('category');
    const addBtn = document.getElementById('addBtn');
    const voiceBtn = document.getElementById('voiceBtn');
    const list = document.getElementById('list');
    const balanceEl = document.getElementById('balance');
    const incomeEl = document.getElementById('income');
    const expenseEl = document.getElementById('expense');
    const downloadBtn = document.getElementById('downloadBtn');
    const backupBtn = document.getElementById('backupBtn');
    const restoreBtn = document.getElementById('restoreBtn');
    const backupArea = document.getElementById('backupArea');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const pieChartCtx = document.getElementById('pieChart').getContext('2d');

    // Data
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];

    // Save & Load
    function saveData() {
      localStorage.setItem('transactions', JSON.stringify(transactions));
    }

    function loadData() {
      transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    }

    // Format currency
    function formatCurrency(num) {
      const sign = num < 0 ? "-" : "";
      return sign + "$" + Math.abs(num).toFixed(2);
    }

    // Render transaction list
    function renderTransactions() {
      list.innerHTML = '';
      if (transactions.length === 0) {
        list.innerHTML = `<li style="text-align:center; color:#999; margin-top:1rem;">No transactions yet</li>`;
        return;
      }
      transactions.forEach((t, i) => {
        const li = document.createElement('li');
        li.className = 'transaction-card ' + (t.amount >= 0 ? 'income' : 'expense');
        li.setAttribute('data-index', i);
        // Category color
        const opt = [...categorySelect.options].find(o => o.value === t.category);
        const color = opt ? opt.dataset.color : '#7f8c8d';

        li.innerHTML = `
          <div class="desc-cat">
            <div><strong>${t.description}</strong></div>
            <div class="category-badge" style="background:${color}">${t.category}</div>
          </div>
          <div class="amount">${formatCurrency(t.amount)}</div>
          <div class="actions" aria-label="Edit or delete transaction">
            <button class="edit" aria-label="Edit transaction">✏️</button>
            <button class="delete" aria-label="Delete transaction">🗑️</button>
          </div>
        `;

        // Edit
        li.querySelector('.edit').onclick = () => editTransaction(i);
        // Delete
        li.querySelector('.delete').onclick = () => deleteTransaction(i);

        list.appendChild(li);
      });
    }

    // Update summary
    function updateSummary() {
      const amounts = transactions.map(t => t.amount);
      const income = amounts.filter(a => a > 0).reduce((a, b) => a + b, 0);
      const expense = amounts.filter(a => a < 0).reduce((a, b) => a + b, 0);
      const balance = income + expense;

      incomeEl.textContent = formatCurrency(income);
      expenseEl.textContent = formatCurrency(expense);
      balanceEl.textContent = formatCurrency(balance);
    }

    // Add transaction
    function addTransaction() {
      const desc = descInput.value.trim();
      const amount = parseFloat(amountInput.value);
      const category = categorySelect.value;

      if (!desc || isNaN(amount)) {
        alert('Please enter valid description and amount!');
        return;
      }
      transactions.push({ description: desc, amount, category });
      saveData();
      renderTransactions();
      updateSummary();
      updatePieChart();
      clearInputs();
    }

    // Clear inputs
    function clearInputs() {
      descInput.value = '';
      amountInput.value = '';
      categorySelect.selectedIndex = 0;
      descInput.focus();
    }

    // Delete transaction
    function deleteTransaction(i) {
      if (confirm('Delete this transaction?')) {
        transactions.splice(i, 1);
        saveData();
        renderTransactions();
        updateSummary();
        updatePieChart();
      }
    }

    // Edit transaction
    function editTransaction(i) {
      const t = transactions[i];
      descInput.value = t.description;
      amountInput.value = t.amount;
      categorySelect.value = t.category;
      addBtn.textContent = 'Update Transaction';
      addBtn.onclick = () => {
        updateTransaction(i);
      };
    }

    // Update transaction
    function updateTransaction(i) {
      const desc = descInput.value.trim();
      const amount = parseFloat(amountInput.value);
      const category = categorySelect.value;

      if (!desc || isNaN(amount)) {
        alert('Please enter valid description and amount!');
        return;
      }
      transactions[i] = { description: desc, amount, category };
      saveData();
      renderTransactions();
      updateSummary();
      updatePieChart();
      clearInputs();
      addBtn.textContent = 'Add Transaction';
      addBtn.onclick = addTransaction;
    }

    // CSV Download
    function downloadCSV() {
      if (transactions.length === 0) {
        alert('No transactions to export!');
        return;
      }
      const header = ['Description', 'Amount', 'Category'];
      const rows = transactions.map(t => [t.description, t.amount, t.category]);
      const csvContent = [header, ...rows].map(e => e.map(v => `"${v}"`).join(',')).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'transactions.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    // Backup JSON
    function backupJSON() {
      backupArea.value = JSON.stringify(transactions, null, 2);
      backupArea.focus();
      backupArea.select();
    }

    // Restore JSON
    function restoreJSON() {
      try {
        const data = JSON.parse(backupArea.value);
        if (!Array.isArray(data)) throw new Error();
        transactions = data;
        saveData();
        renderTransactions();
        updateSummary();
        updatePieChart();
        alert('Data restored successfully!');
      } catch {
        alert('Invalid JSON data!');
      }
    }

    // Dark mode toggle
    function toggleDarkMode() {
      const isDark = document.body.classList.toggle('dark');
      darkModeToggle.setAttribute('aria-pressed', isDark);
      localStorage.setItem('darkMode', isDark);
    }

    // Load dark mode preference
    function loadDarkMode() {
      const darkMode = localStorage.getItem('darkMode') === 'true';
      if (darkMode) {
        document.body.classList.add('dark');
        darkModeToggle.setAttribute('aria-pressed', true);
      }
    }

    // Pie chart setup
    let pieChart;
    function updatePieChart() {
      const categorySums = {};
      transactions.forEach(t => {
        if (t.amount < 0) { // expenses only
          categorySums[t.category] = (categorySums[t.category] || 0) + Math.abs(t.amount);
        }
      });
      const labels = Object.keys(categorySums);
      const data = labels.map(l => categorySums[l]);
      const bgColors = labels.map(label => {
        const opt = [...categorySelect.options].find(o => o.value === label);
        return opt ? opt.dataset.color : '#7f8c8d';
      });

      if (pieChart) pieChart.destroy();
      pieChart = new Chart(pieChartCtx, {
        type: 'pie',
        data: {
          labels,
          datasets: [{
            data,
            backgroundColor: bgColors,
            borderWidth: 1,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: getComputedStyle(document.body).color }
            }
          }
        }
      });
    }

    // Voice input
    let recognition;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        voiceBtn.classList.add('listening');
        voiceBtn.textContent = '🎙️...';
      };

      recognition.onend = () => {
        voiceBtn.classList.remove('listening');
        voiceBtn.textContent = '🎤 Voice';
      };

      recognition.onresult = (event) => {
        const spoken = event.results[0][0].transcript.trim();
        // Expect format: "Description amount category"
        // e.g. "Groceries 50 food"
        const parts = spoken.toLowerCase().split(' ');
        // Try to parse last word as category if matches
        let cat = null;
        let amt = null;
        let desc = null;

        const categories = [...categorySelect.options].map(o => o.value.toLowerCase());
        // Find last word category match
        for (let i = parts.length - 1; i >= 0; i--) {
          if (categories.includes(parts[i])) {
            cat = parts[i];
            parts.splice(i, 1);
            break;
          }
        }
        // Find amount (number) in remaining parts
        for (let i = 0; i < parts.length; i++) {
          const n = parseFloat(parts[i]);
          if (!isNaN(n)) {
            amt = n;
            parts.splice(i, 1);
            break;
          }
        }
        desc = parts.join(' ') || 'Voice input';

        if (amt === null || cat === null) {
          alert(`Couldn't parse amount or category. Please say like: "Groceries 50 food"`);
          return;
        }
        descInput.value = desc;
        amountInput.value = amt;
        categorySelect.value = cat.charAt(0).toUpperCase() + cat.slice(1);
        addTransaction();
      };

      voiceBtn.onclick = () => {
        recognition.start();
      };
    } else {
      voiceBtn.style.display = 'none';
    }

    // Event listeners
    addBtn.onclick = addTransaction;
    downloadBtn.onclick = downloadCSV;
    backupBtn.onclick = backupJSON;
    restoreBtn.onclick = restoreJSON;
    darkModeToggle.onclick = toggleDarkMode;

    // Init
    function init() {
      loadData();
      renderTransactions();
      updateSummary();
      updatePieChart();
      loadDarkMode();
    }
    init();
  })();
</script>
</body>
</html>
